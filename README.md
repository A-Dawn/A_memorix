# A_Memorix

**è½»é‡çº§çŸ¥è¯†å›¾è°±æ’ä»¶** - åŸºäºåŒè·¯æ£€ç´¢ + äººç‰©ç”»åƒçš„ç‹¬ç«‹è®°å¿†å¢å¼ºç³»ç»Ÿ (v0.5.0)

> æ¶ˆãˆã¦ã„ã‹ãªã„æ„Ÿè¦š , ã¾ã ã¾ã è¶³ã‚Šã¦ãªã„ã¿ãŸã„ !

> [!WARNING]
> **é‡è¦æç¤º**ï¼šv0.2.0 ç‰ˆæœ¬ç”±äºåº•å±‚å­˜å‚¨æ¶æ„é‡æ„ï¼ˆå¼•å…¥ SciPy ç¨€ç–çŸ©é˜µä¸ Faiss SQ8 é‡åŒ–ï¼‰ï¼Œ**ä¸ v0.1.3 åŠæ—©æœŸç‰ˆæœ¬çš„å¯¼å…¥æ•°æ®ä¸å®Œå…¨å…¼å®¹**ã€‚
> å‡çº§åï¼Œè™½ç„¶ç³»ç»Ÿä¼šå°è¯•è‡ªåŠ¨è¿ç§»éƒ¨åˆ†æ•°æ®ï¼Œä½†ä¸ºç¡®ä¿çŸ¥è¯†å›¾è°±çš„æ£€ç´¢ç²¾åº¦å’Œå®Œæ•´æ€§ï¼Œå¼ºçƒˆå»ºè®®åœ¨å‡çº§åä½¿ç”¨ `process_knowledge.py` è„šæœ¬é‡æ–°å¯¼å…¥åŸå§‹æ–‡æœ¬ã€‚

> [!NOTE]
> **v0.5.0 äººç‰©ç”»åƒå¢å¼ºï¼ˆä¸»æ›´æ–°ï¼‰**ï¼š
> 1. æ–°å¢ `PersonProfileService`ï¼ŒåŸºäºâ€œåˆ«åè§£æ + å›¾å…³ç³»è¯æ® + å‘é‡è¯æ®â€ç”Ÿæˆäººç‰©ç”»åƒå¿«ç…§ï¼›
> 2. æ–°å¢ `/person_profile on|off|status`ï¼Œæ”¯æŒæŒ‰ `stream_id + user_id` æ§åˆ¶ç”»åƒæ³¨å…¥ï¼›
> 3. `knowledge_query` æ–°å¢ `query_type=person`ï¼Œ`/query person|p` æ”¯æŒäººç‰©ç”»åƒæŸ¥è¯¢ï¼›
> 4. æ–°å¢ç”»åƒå®šæ—¶åˆ·æ–°ä»»åŠ¡ä¸ override/å¿«ç…§å­˜å‚¨èƒ½åŠ›ï¼ˆä¾èµ– metadata æ–°è¡¨ï¼‰ã€‚
> 
> **v0.5.0 ç‰ˆæœ¬ä¸SchemaåŒæ­¥**ï¼š
> 1. æ’ä»¶ç‰ˆæœ¬å‡çº§åˆ° `0.5.0`ï¼›
> 2. é…ç½®ç‰ˆæœ¬å‡çº§åˆ° `4.0.0`ï¼›
> 3. `manifest_version` å‡çº§åˆ° `2`ã€‚

## ğŸ“‘ æ–‡æ¡£ç´¢å¼•

- [âš¡ å¿«é€Ÿå…¥é—¨ï¼ˆ5åˆ†é’Ÿä¸Šæ‰‹ï¼‰](QUICK_START.md)
- [ğŸ“˜ é…ç½®å‚æ•°è¯¦è§£ï¼ˆconfig.tomlï¼‰](CONFIG_REFERENCE.md)
- [ğŸ“— å¯¼å…¥æŒ‡å—ä¸æœ€ä½³å®è·µ](IMPORT_GUIDE.md)
- [ğŸ“ æ›´æ–°æ—¥å¿—](CHANGELOG.md)

---

## âœ¨ ç‰¹æ€§

- **ğŸ§  åŒè·¯æ£€ç´¢** - å…³ç³»å›¾è°± + å‘é‡è¯­ä¹‰å¹¶è¡Œæ£€ç´¢ï¼Œç»“åˆ Personalized PageRank æ™ºèƒ½æ’åºã€‚
- **â±ï¸ æ—¶åºæ£€ç´¢ï¼ˆåˆ†é’Ÿçº§ï¼‰** - æ”¯æŒ `time/hybrid` æ¨¡å¼ï¼ŒæŒ‰äº‹ä»¶æ—¶é—´åŒºé—´å‘½ä¸­å¹¶å¯å›é€€ `created_at`ã€‚
- **ğŸ‘¤ äººç‰©ç”»åƒï¼ˆv0.5.0ï¼‰** - æ”¯æŒäººç‰©ç”»åƒå¿«ç…§ã€åˆ«åè§£æã€æ‰‹å·¥è¦†ç›–ã€æŒ‰ä¼šè¯ opt-in æ³¨å…¥æ§åˆ¶ã€‚
- **ğŸ§© ç¨€ç–æ£€ç´¢å¢å¼ºï¼ˆFTS5 + BM25ï¼‰** - embedding ä¸å¯ç”¨æˆ–å¬å›åå¼±æ—¶è‡ªåŠ¨èµ° sparseï¼Œæ”¯æŒ `jieba/mixed/char_2gram` åˆ†è¯ä¸ `ngram` å€’æ’å›é€€ã€‚
- **ğŸ§¬ ç”Ÿç‰©å­¦è®°å¿† (V5)** - æ¨¡æ‹Ÿäººç±»è®°å¿†çš„**è¡°å‡ (Decay)**ã€**å¼ºåŒ– (Reinforce)** ä¸ **ç»“æ„åŒ–é‡ç»„ (Prune)** æœºåˆ¶ï¼Œå®ç°è®°å¿†çš„åŠ¨æ€ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚
- **ğŸ”„ æ™ºèƒ½å›é€€** - å½“ç›´æ¥æ£€ç´¢ç»“æœå¼±æ—¶ï¼Œè‡ªåŠ¨è§¦å‘å¤šè·³è·¯å¾„æœç´¢ï¼Œå¢å¼ºé—´æ¥å…³ç³»å¬å›ã€‚
- **ğŸ›¡ï¸ ç½‘ç»œé²æ£’æ€§** - å†…ç½®æŒ‡æ•°é€€é¿é‡è¯•æœºåˆ¶ï¼Œæ”¯æŒè‡ªå®šä¹‰åµŒå…¥è¯·æ±‚çš„é‡è¯•ç­–ç•¥ï¼Œä»å®¹åº”å¯¹ç½‘ç»œæ³¢åŠ¨ã€‚
- **ğŸ“Š çŸ¥è¯†å›¾è°±å¯è§†åŒ–** - å…¨æ–° Glassmorphism é£æ ¼ Web ç¼–è¾‘å™¨ï¼Œæ”¯æŒåŸºäº **PageRank** çš„ä¿¡æ¯å¯†åº¦ç­›é€‰ã€è®°å¿†æº¯æºç®¡ç†åŠå…¨é‡å›¾è°±æ¢ç´¢ã€‚
- **ğŸ“ å¯¹è¯è‡ªåŠ¨æ€»ç»“** - è‡ªåŠ¨æ€»ç»“å†å²èŠå¤©è®°å½•å¹¶æå–çŸ¥è¯†ï¼Œæ”¯æŒå®šæ—¶è§¦å‘å’Œäººè®¾æ·±åº¦æ•´åˆã€‚
- **ğŸ¯ æ™ºèƒ½åˆ†ç±»** - å…¼å®¹å¹¶è‡ªåŠ¨è¯†åˆ«ç»“æ„åŒ–/å™äº‹æ€§/äº‹å®æ€§çŸ¥è¯†ï¼Œé‡‡ç”¨å·®å¼‚åŒ–å¤„ç†ç­–ç•¥ã€‚
- **ğŸ’¾ é«˜æ•ˆå­˜å‚¨** - SciPy ç¨€ç–çŸ©é˜µå­˜å‚¨å›¾ç»“æ„ï¼ŒFaiss SQ8 å‘é‡é‡åŒ–èŠ‚çœ 75%+ ç©ºé—´ã€‚
- **ğŸ”Œ å®Œå…¨ç‹¬ç«‹** - ä¸ä¾èµ–åŸ LPMM ç³»ç»Ÿï¼Œæ‹¥æœ‰ç‹¬ç«‹çš„æ•°æ®æ ¼å¼å’Œå­˜å‚¨è·¯å¾„ã€‚
- **ğŸ¤– LLM é›†æˆ** - æä¾› Tool å’Œ Action ç»„ä»¶ï¼Œæ”¯æŒ LLM è‡ªä¸»è°ƒç”¨çŸ¥è¯†åº“ã€‚

---

## ğŸ“¦ å®‰è£…

### æ–¹å¼ä¸€ï¼šä¸€é”®å®‰è£…ï¼ˆæ¨èï¼‰

å¦‚æœä¸»ç¨‹åºæ”¯æŒæ’ä»¶ä¾èµ–ç®¡ç†ï¼Œæ’ä»¶å¯ç”¨æ—¶ä¼šè‡ªåŠ¨å°è¯•å®‰è£… `python_dependencies`ã€‚

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨å®‰è£…

åœ¨ä¸»ç¨‹åºæ ¹ç›®å½•ä¸‹è¿›å…¥è™šæ‹Ÿç¯å¢ƒåï¼Œåœ¨æ’ä»¶ç›®å½•ä¸‹è¿è¡Œï¼š

```bash
pip install -r requirements.txt
```

**æ ¸å¿ƒä¾èµ–ï¼š**

- `numpy`, `scipy` (è®¡ç®—ä¸çŸ©é˜µ)
- `faiss-cpu` (å‘é‡æ£€ç´¢)
- `rich` (ç»ˆç«¯å¯è§†åŒ–)
- `tenacity` (é‡è¯•æœºåˆ¶)
- `nest-asyncio` (ç¯å¢ƒå…¼å®¹)
- `jieba` (ç¨€ç–æ£€ç´¢ä¸­æ–‡åˆ†è¯ï¼›æœªå®‰è£…æ—¶è‡ªåŠ¨å›é€€ char n-gram)
- `fastapi`, `uvicorn`, `pydantic` (å¯è§†åŒ–æœåŠ¡å™¨)

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

A_Memorix æä¾›å¤šç§æ–¹å¼ç®¡ç†çŸ¥è¯†åº“ï¼Œå»ºè®®ä¼˜å…ˆé€‰æ‹© **è‡ªåŠ¨åŒ–è„šæœ¬** è¿›è¡Œåˆå§‹åŒ–ï¼Œé…åˆ **å¯è§†åŒ–ç¼–è¾‘å™¨** è¿›è¡Œæ—¥å¸¸ç»´æŠ¤ã€‚

### 1. è‡ªåŠ¨åŒ–æ‰¹é‡å¯¼å…¥ (`process_knowledge.py`)

> ğŸ“– **è¯¦ç»†æŒ‡å—**ï¼šå…³äºå„ç±»æ–‡æœ¬çš„æ ¼å¼è¦æ±‚ã€ç­–ç•¥é€‰æ‹©åŠå„ç±»ç¤ºä¾‹ï¼Œè¯·åŠ¡å¿…é˜…è¯» [**å¯¼å…¥æŒ‡å—ä¸æœ€ä½³å®è·µ**](IMPORT_GUIDE.md)ã€‚

é€‚ç”¨äºä»å¤§é‡å†å²æ–‡æ¡£å¿«é€Ÿæ„å»ºçŸ¥è¯†åº“ã€‚è„šæœ¬ä¼šè‡ªåŠ¨è°ƒç”¨ LLM æå–å®ä½“å’Œå…³ç³»ã€‚

**æ–‡ä»¶è¦æ±‚ï¼š**

- **æ ¼å¼**ï¼šä»…æ”¯æŒ `.txt` å¹³é¢æ–‡æœ¬ã€‚
- **å†…å®¹**ï¼šæ”¯æŒ**è‡ªç”±å½¢å¼çš„è‡ªç„¶è¯­è¨€æ–‡æœ¬**ã€‚æ— éœ€ç‰¹å®šæ ‡è®°æˆ–ç»“æ„ï¼Œè„šæœ¬ä¼šè°ƒç”¨ LLM è‡ªåŠ¨åˆ†æå…¶ä¸­çš„å®ä½“ä¸å…³ç³»ã€‚
- **ç¼–ç **ï¼šå¿…é¡»ä½¿ç”¨ `UTF-8` ç¼–ç ã€‚
- **è·¯å¾„**ï¼šæ–‡ä»¶éœ€æ”¾å…¥ `plugins/A_memorix/data/raw/` ç›®å½•ã€‚

**æ“ä½œæ­¥éª¤ï¼š**

1. å°† `.txt` æ ¼å¼çš„åŸå§‹æ–‡æ¡£æ”¾å…¥ `plugins/A_memorix/data/raw/` ç›®å½•ã€‚
2. è¿è¡Œè„šæœ¬ï¼ˆè¯·ç¡®å®šä½ è¿è¡Œè„šæœ¬çš„ç¯å¢ƒå·²ç»å®‰è£…äº†ä¾èµ–ï¼‰ï¼š
   ```bash
   python plugins/A_memorix/scripts/process_knowledge.py
   ```

**æ”¯æŒå‚æ•°ï¼š**

- `--force`: å¼ºåˆ¶é‡æ–°å¯¼å…¥å·²å¤„ç†è¿‡çš„æ–‡ä»¶ã€‚
- `--clear-manifest`: æ¸…ç©ºå¯¼å…¥å†å²è®°å½•å¹¶é‡æ–°æ‰«æã€‚
- `--type <type>`: æŒ‡å®šå†…å®¹ç±»å‹ï¼ˆ`structured`, `narrative`, `factual`ï¼‰ã€‚
- `--chat-log`: èŠå¤©è®°å½•æ¨¡å¼ã€‚é»˜è®¤æŒ‰ `narrative` å¤„ç†ï¼Œå¹¶ä½¿ç”¨ LLM è¯­ä¹‰ç†è§£æå– `event_time/event_time_start/event_time_end`ï¼ˆå¯è§£æç›¸å¯¹æ—¶é—´ï¼‰ã€‚
- `--chat-reference-time <datetime>`: èŠå¤©è®°å½•æ¨¡å¼çš„ç›¸å¯¹æ—¶é—´å‚è€ƒç‚¹ï¼ˆå¦‚ `2026/02/12 10:30`ï¼‰ï¼›ä¸ä¼ åˆ™ä½¿ç”¨å½“å‰æœ¬åœ°æ—¶é—´ã€‚

### 1.1 è¿ç§» LPMM æ•°æ® (`import_lpmm_json.py`)

å¦‚æœä½ æœ‰ç¬¦åˆ LPMM è§„èŒƒçš„ OpenIE JSON æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨æ­¤è„šæœ¬å°†å…¶è½¬æ¢ä¸º A_Memorix æ ¼å¼å¹¶å¯¼å…¥ï¼š

```bash
python plugins/A_memorix/scripts/import_lpmm_json.py <path_to_json_file_or_dir>
```

**å‚æ•°ï¼š**

- `path`: JSON æ–‡ä»¶è·¯å¾„æˆ–åŒ…å« `*-openie.json` çš„ç›®å½•ã€‚
- `--force`: å¼ºåˆ¶é‡æ–°å¯¼å…¥ã€‚

### 1.2 è½¬æ¢ LPMM å­˜å‚¨æ–‡ä»¶ (`convert_lpmm.py`)  [æ–°å¢]

å¦‚æœä½ æœ‰ LPMM å¯¼å‡ºçš„ parquet/graph æ–‡ä»¶ï¼Œå¯ä½¿ç”¨è¯¥è„šæœ¬ç›´æ¥è½¬æ¢ä¸º A_Memorix å­˜å‚¨ç»“æ„ï¼š

```bash
python plugins/A_memorix/scripts/convert_lpmm.py -i <lpmm_data_dir> -o <output_data_dir> --dim 384
```

**è¯´æ˜ï¼š**

- è¾“å…¥ç›®å½•æ”¯æŒ `paragraph.parquet`ã€`entity.parquet` ä»¥åŠ `rag-graph.graphml/graph.graphml/graph_structure.pkl`ã€‚
- å½“å‰ç‰ˆæœ¬ä¼˜å…ˆä¿è¯ ID ä¸å…ƒæ•°æ®ä¸€è‡´æ€§ï¼Œå…³ç³»å‘é‡ä¸åšç›´æ¥å¯¼å…¥ï¼ˆé¿å…æ£€ç´¢åæŸ¥ä¸ä¸€è‡´ï¼‰ã€‚

### 1.3 å›å¡«æ—§æ•°æ®æ—¶åºå­—æ®µ (`backfill_temporal_metadata.py`)

å½“å†å²æ®µè½ç¼ºå¤± `event_time/event_time_start/event_time_end` æ—¶ï¼Œå¯ä½¿ç”¨è„šæœ¬æŒ‰ `created_at` å›å¡«ï¼Œæå‡ `time/hybrid` æ£€ç´¢å‘½ä¸­ç‡ï¼š

```bash
python plugins/A_memorix/scripts/backfill_temporal_metadata.py --dry-run
python plugins/A_memorix/scripts/backfill_temporal_metadata.py --limit 50000
```

é»˜è®¤å›å¡«ç­–ç•¥ï¼š`event_time=created_at`ã€`time_granularity=day`ã€`time_confidence=0.2`ã€‚

### 2. æŒ‡ä»¤äº¤äº’

åœ¨èŠå¤©çª—å£ä¸­ç›´æ¥è¾“å…¥ä»¥ä¸‹ä¸€çº§å‘½ä»¤è¿›è¡Œæ“ä½œï¼š

| å‘½ä»¤         | æ¨¡å¼                                             | è¯´æ˜                | ç¤ºä¾‹                         |
| ------------ | ------------------------------------------------ | ------------------- | ---------------------------- |
| `/import`    | `text`, `paragraph`, `relation`, `file`, `json`  | å¯¼å…¥çŸ¥è¯†            | `/import text äººå·¥æ™ºèƒ½æ˜¯...` |
| `/query`     | `search(s)`, `time(t)`, `entity(e)`, `relation(r)`, `stats` | æŸ¥è¯¢çŸ¥è¯† | `/query t q=é¡¹ç›®è¿›å±• from=2025/01/01 to=2025/01/31` |
| `/delete`    | `paragraph`, `entity`, `clear`                   | åˆ é™¤çŸ¥è¯†            | `/delete paragraph <hash>`   |
| `/memory`    | `status`, `protect`, `reinforce`, `restore`      | è®°å¿†ç³»ç»Ÿç»´æŠ¤ (V5)   | `/memory status`             |
| `/person_profile` | `on`, `off`, `status`                         | äººç‰©ç”»åƒæ³¨å…¥å¼€å…³ï¼ˆæŒ‰ä¼šè¯+ç”¨æˆ·ï¼‰ | `/person_profile on` |
| `/visualize` | -                                                | å¯åŠ¨å¯è§†åŒ– Web é¢æ¿ | `/visualize`                 |

#### ğŸ§  è®°å¿†ç³»ç»Ÿç»´æŠ¤ (`/memory`)

- **æŸ¥çœ‹çŠ¶æ€**: `/memory status` - æ˜¾ç¤ºæ´»è·ƒ/å†·å†»/ä¿æŠ¤è®°å¿†æ•°é‡åŠç³»ç»Ÿå‚æ•°ã€‚
- **ä¿æŠ¤è®°å¿†**: `/memory protect <query> [hours]` - ä¿æŠ¤ç›¸å…³è®°å¿†ä¸è¢«è¡°å‡/ä¿®å‰ªã€‚
  - ä¸å¡«æ—¶é—´ = **æ°¸ä¹…é”å®š (Pin)**
  - å¡«æ—¶é—´ = **ä¸´æ—¶ä¿æŠ¤ (TTL)** (e.g., `/memory protect æ˜¨å¤©çš„ä¼šè®® 24`)
- **æ‰‹åŠ¨å¼ºåŒ–**: `/memory reinforce <query>` - æ‰‹åŠ¨è§¦å‘æ£€ç´¢å¼ºåŒ–ï¼ˆç»•è¿‡å†·å´æ—¶é—´ï¼‰ï¼Œæå‡è®°å¿†æƒé‡ã€‚
- **æ¢å¤è®°å¿†**: `/memory restore <hash>` - ä»å›æ”¶ç«™æ¢å¤è¯¯åˆ è®°å¿†ï¼ˆä»…å½“èŠ‚ç‚¹å­˜åœ¨æ—¶æœ‰æ•ˆï¼‰ã€‚

#### ğŸ“‚ å¯¼å…¥çŸ¥è¯† (`/import`)

- **æ–‡æœ¬ï¼ˆè‡ªåŠ¨æå–ï¼‰**ï¼š`/import text çŸ¥è¯†å†…å®¹...`
- **å•ä¸ªæ®µè½**ï¼š`/import paragraph æ®µè½å†…å®¹...`
- **å…³ç³» (ä¸»|è°“|å®¾)**ï¼š`/import relation Apple|founded|Steve Jobs`
- **æ–‡ä»¶ (.txt, .md, .json)**ï¼š`/import file ./my_notes.txt`
- **JSON ç»“æ„åŒ–**ï¼š`/import json {"paragraphs": [...], "entities": [...], "relations": [...]}`

#### ğŸ” æŸ¥è¯¢çŸ¥è¯† (`/query`)

- **å…¨æ–‡æ£€ç´¢**ï¼š`/query search <query>` (ç¼©å†™: `/query s`) - æ”¯æŒæ™ºèƒ½å›é€€åˆ°è·¯å¾„æœç´¢ã€‚
- **æ—¶åºæ£€ç´¢**ï¼š`/query time <k=vå‚æ•°>` (ç¼©å†™: `/query t`) - æ”¯æŒ `q/query`ã€`from/start`ã€`to/end`ã€`person`ã€`source`ã€`top_k`ã€‚
  - æ—¶é—´æ ¼å¼ä»…æ”¯æŒï¼š`YYYY/MM/DD` æˆ– `YYYY/MM/DD HH:mm`ã€‚
  - æ—¥æœŸæ ¼å¼ä¼šè‡ªåŠ¨å±•å¼€ï¼š`from -> 00:00`ï¼Œ`to -> 23:59`ã€‚
- **å®ä½“æŸ¥è¯¢**ï¼š`/query entity <name>` (ç¼©å†™: `/query e`)
- **å…³ç³»æŸ¥è¯¢**ï¼š`/query relation <spec>` (ç¼©å†™: `/query r`) - æ”¯æŒè‡ªç„¶è¯­è¨€æˆ– `S|P|O` æ ¼å¼ã€‚
- **ç»Ÿè®¡ä¿¡æ¯**ï¼š`/query stats`
- **äººç‰©ç”»åƒ**ï¼š`/query person <id|åˆ«å>`ï¼ˆç®€å†™ï¼š`/query p`ï¼‰

#### ğŸ—‘ï¸ åˆ é™¤ä¸ç»´æŠ¤

- **æŒ‰ Hash åˆ é™¤æ®µè½**ï¼š`/delete paragraph <hash>`
- **åˆ é™¤ç‰¹å®šå®ä½“**ï¼š`/delete entity <name>`
- **æ¸…ç©ºæ•°æ®åº“**ï¼š`/delete clear` (æ…ç”¨ï¼)

### 3. å¯è§†åŒ–ç¼–è¾‘ (æ¨è)

è¿è¡Œ `/visualize` å‘½ä»¤åï¼Œè®¿é—® `http://localhost:8082` å³å¯è¿›å…¥å›¾å½¢åŒ–ç¼–è¾‘å™¨ã€‚æ”¯æŒï¼š

- èŠ‚ç‚¹/å…³è”çš„å®æ—¶å¢åˆ æ”¹æŸ¥ã€‚
- **æ˜¾è‘—æ€§è§†å›¾**: é€šè¿‡åº•éƒ¨çš„â€œDock æ â€ -> â€œè§†å›¾é…ç½®â€ï¼Œè°ƒæ•´ä¿¡æ¯å¯†åº¦æ»‘å—ï¼ŒæŸ¥çœ‹ä»æ ¸å¿ƒéª¨å¹²åˆ°å…¨é‡ç»†èŠ‚çš„ä¸åŒå±‚çº§å›¾è°±ã€‚
- **è®°å¿†æº¯æº**: é€šè¿‡â€œè®°å¿†æº¯æºâ€é¢æ¿ï¼ŒæŒ‰å¯¼å…¥æ–‡ä»¶ï¼ˆæ¥æºï¼‰æ‰¹é‡ç®¡ç†å’Œåˆ é™¤è®°å¿†ã€‚
- **çŸ¥è¯†å­—å…¸**: æµè§ˆæ‰€æœ‰å®ä½“ä¸å…³ç³»çš„åˆ—è¡¨è§†å›¾ã€‚

### 4. æ ¸å¿ƒé…ç½®è¯´æ˜ (`config.toml`)

ä½ å¯ä»¥é€šè¿‡ä¿®æ”¹ `config.toml` æ¥å®šåˆ¶æ’ä»¶è¡Œä¸ºã€‚v0.2.0 ç‰ˆæœ¬æä¾›äº†æ›´ç»†ç²’åº¦çš„æ§åˆ¶ã€‚
å®Œæ•´é€é¡¹è¯´æ˜è¯·æŸ¥çœ‹ï¼š[ğŸ“˜ é…ç½®å‚æ•°è¯¦è§£ï¼ˆconfig.tomlï¼‰](CONFIG_REFERENCE.md)ã€‚

#### ğŸ’¾ å­˜å‚¨ä¸åµŒå…¥ `[storage] & [embedding]`

- **`storage.data_dir`**: æ•°æ®å­˜å‚¨è·¯å¾„ï¼ˆé»˜è®¤ä¸ºæ’ä»¶å†… `data` ç›®å½•ï¼‰ã€‚
- **`embedding.quantization_type`**: å‘é‡é‡åŒ–æ¨¡å¼ (`int8` æ¨è, `float32`, `pq`)ã€‚
- **`embedding.dimension`**: å‘é‡ç»´åº¦ï¼ˆé»˜è®¤ 1024ï¼‰ã€‚
- **`embedding.retry.max_attempts`**: æœ€å¤§é‡è¯•æ¬¡æ•° (é»˜è®¤ 10)ã€‚
- **`embedding.retry.max_wait_seconds`**: æœ€å¤§ç­‰å¾…æ—¶é—´ (é»˜è®¤ 30)ã€‚

#### âš™ï¸ æ£€ç´¢ä¸æ’åº `[retrieval]`

- **`alpha`**: åŒè·¯æ£€ç´¢èåˆæƒé‡ (0.0=ä»…å…³ç³», 1.0=ä»…æ®µè½, 0.5=å¹³è¡¡)ã€‚
- **`enable_ppr`**: æ˜¯å¦å¯ç”¨ Personalized PageRank ç®—æ³•ä¼˜åŒ–æ’åºã€‚
- **`top_k_relations` / `top_k_paragraphs`**: åˆ†åˆ«æ§åˆ¶å•è·¯æ£€ç´¢å¬å›æ•°é‡ã€‚
- **`relation_semantic_fallback`**: æ˜¯å¦å…è®¸å…³ç³»æ£€ç´¢å›é€€åˆ°è¯­ä¹‰æœç´¢ã€‚
- **`search.smart_fallback.enabled`**: search ä½åˆ†æ—¶æ˜¯å¦å¯ç”¨è·¯å¾„å›é€€ï¼ˆé»˜è®¤ `true`ï¼‰ã€‚
- **`search.smart_fallback.threshold`**: search è·¯å¾„å›é€€è§¦å‘é˜ˆå€¼ï¼ˆé»˜è®¤ `0.6`ï¼‰ã€‚
- **`search.safe_content_dedup.enabled`**: ç»Ÿä¸€é“¾è·¯å®‰å…¨å»é‡å¼€å…³ï¼ˆé»˜è®¤ `true`ï¼‰ã€‚
- **`time.skip_threshold_when_query_empty`**: time ä¸” query ä¸ºç©ºæ—¶è·³è¿‡é˜ˆå€¼è¿‡æ»¤ï¼ˆé»˜è®¤ `true`ï¼‰ã€‚
- **`sparse.mode`**: ç¨€ç–æ£€ç´¢æ¨¡å¼ï¼ˆ`auto/fallback_only/hybrid`ï¼‰ï¼Œé»˜è®¤ `auto`ã€‚
- **`sparse.tokenizer_mode`**: åˆ†è¯æ¨¡å¼ï¼ˆ`jieba/mixed/char_2gram`ï¼‰ã€‚
- **`sparse.enable_ngram_fallback_index`**: FTS miss æ—¶å¯ç”¨ ngram å€’æ’å›é€€ï¼ˆé»˜è®¤å¼€ï¼‰ã€‚
- **`sparse.enable_relation_sparse_fallback`**: å…³ç³»é€šé“ç¨€ç–å›é€€ç‹¬ç«‹å¼€å…³ï¼ˆé»˜è®¤å¼€ï¼‰ã€‚
- **`fusion.method`**: èåˆæ–¹æ³•ï¼ˆé»˜è®¤ `weighted_rrf`ï¼Œæ”¯æŒå‘é‡+BM25 å€™é€‰èåˆï¼‰ã€‚
- **`fusion.vector_weight + fusion.bm25_weight`**: è‹¥å’Œä¸ä¸º 1ï¼Œä¼šè‡ªåŠ¨å½’ä¸€åŒ–ã€‚

#### ğŸ”€ æ£€ç´¢è·¯ç”± `[routing]`

- **`search_owner`**: `search/time` ä¸»è´£å…¥å£ï¼ˆ`action|tool|dual`ï¼‰ï¼Œé»˜è®¤ `action`ã€‚
- **`tool_search_mode`**: Tool åœ¨ `search/time` çš„æ¨¡å¼ï¼ˆ`forward|disabled`ï¼‰ï¼Œé»˜è®¤ `forward`ï¼›`legacy` ä¸ºå…¼å®¹åˆ«åå¹¶æŒ‰ `forward` å¤„ç†ã€‚
- **`enable_request_dedup`**: å¯ç”¨çŸ­æ—¶è¯·æ±‚å»é‡ï¼ŒæŠ‘åˆ¶ Action+Tool åŒè½®é‡å¤æ£€ç´¢ã€‚
- **`request_dedup_ttl_seconds`**: å»é‡ TTLï¼Œé»˜è®¤ `2` ç§’ã€‚

#### ğŸ‘¤ äººç‰©ç”»åƒ `[person_profile]`

- **`enabled`**: äººç‰©ç”»åƒæ¨¡å—æ€»å¼€å…³ã€‚
- **`opt_in_required`**: æ˜¯å¦è¦æ±‚æ˜¾å¼å¼€å¯æ³¨å…¥ï¼ˆé»˜è®¤ `true`ï¼‰ã€‚
- **`default_injection_enabled`**: æ— æ˜¾å¼å¼€å…³è®°å½•æ—¶çš„é»˜è®¤æ³¨å…¥çŠ¶æ€ã€‚
- **`profile_ttl_minutes`**: ç”»åƒå¿«ç…§ TTLã€‚
- **`refresh_interval_minutes`**: å®šæ—¶åˆ·æ–°å‘¨æœŸã€‚
- **`active_window_hours`**: ä»…åˆ·æ–°æ´»è·ƒçª—å£å†…äººç‰©ã€‚
- **`max_refresh_per_cycle`**: æ¯è½®æœ€å¤§åˆ·æ–°äººæ•°ã€‚
- **`top_k_evidence`**: ç”»åƒæ„å»ºè¯æ®ä¸Šé™ã€‚

#### ğŸ§© ç¨€ç–æ£€ç´¢è¡Œä¸ºè¯´æ˜

- `sparse.mode=auto` ä¸‹ï¼Œæ»¡è¶³ä»»ä¸€æ¡ä»¶ä¼šè§¦å‘æ®µè½ sparseï¼šembedding ä¸å¯ç”¨ã€å‘é‡ç»“æœä¸ºç©ºã€å‘é‡æœ€é«˜åˆ† `< 0.45`ã€‚
- æ®µè½ sparse å›é€€é“¾è·¯ï¼š`FTS5 BM25 -> ngram å€’æ’ -> (å¯é€‰)LIKE æ‰«æ`ã€‚
- å…³ç³» sparse æ˜¯å¦å‚ä¸ç”± `sparse.enable_relation_sparse_fallback` æ§åˆ¶ã€‚
- é¦–æ¬¡åŠ è½½ sparse å¯èƒ½è§¦å‘ FTS/å€’æ’å›å¡«ï¼Œå†·å¯åŠ¨æ—¶å»¶ä¼šé«˜äºå¸¸æ€ã€‚

#### ğŸ§¬ è®°å¿†ç³»ç»Ÿ (V5) `[memory]`

- **`half_life_hours`**: è®°å¿†åŠè¡°æœŸï¼ˆå°æ—¶ï¼‰ã€‚å›¾è°±è¿æ¥æƒé‡æ¯ç»è¿‡ä¸€ä¸ªåŠè¡°æœŸä¼šè¡°å‡ 50%ã€‚(é»˜è®¤ 24.0)
- **`enable_auto_reinforce`**: æ˜¯å¦å¼€å¯æ£€ç´¢å¼ºåŒ–ã€‚å¼€å¯åï¼Œè¢«æœç´¢å‘½ä¸­çš„è®°å¿†ä¼šè‡ªåŠ¨æ¢å¤æ´»è·ƒå¹¶å¢åŠ æƒé‡ã€‚(é»˜è®¤ true)
- **`prune_threshold`**: å†»ç»“/ä¿®å‰ªé˜ˆå€¼ã€‚æƒé‡ä½äºæ­¤å€¼çš„éä¿æŠ¤è®°å¿†å°†è¢«å†»ç»“ã€‚(é»˜è®¤ 0.1)
- **`freeze_duration_hours`**: å†·å†»æœŸæ—¶é•¿ã€‚è®°å¿†å†»ç»“è¶…è¿‡æ­¤æ—¶é•¿åå°†è¢«ç§»å…¥å›æ”¶ç«™ã€‚(é»˜è®¤ 24.0)

#### ğŸ¯ åŠ¨æ€é˜ˆå€¼ `[threshold]`

- **`min_threshold`**: ç¡¬æ€§æœ€å°ç›¸ä¼¼åº¦é˜ˆå€¼ (é»˜è®¤ 0.3)ã€‚
- **`enable_auto_adjust`**: æ˜¯å¦å¯ç”¨åŠ¨æ€é˜ˆå€¼è°ƒæ•´ï¼ˆåŸºäºç»“æœåˆ†å¸ƒï¼‰ã€‚
- **`std_multiplier`**: å¼‚å¸¸å€¼è¿‡æ»¤çš„æ ‡å‡†å·®å€æ•°ã€‚

#### ğŸ§  è‡ªåŠ¨åŒ–åŠŸèƒ½ `[summarization] & [schedule]`

- **`summarization.enabled`**: å¼€å¯å¯¹è¯è‡ªåŠ¨æ€»ç»“ã€‚
- **`summarization.model_name`**: æ”¯æŒ `auto` / ä»»åŠ¡å / æ¨¡å‹åï¼›ä¹Ÿæ”¯æŒæ•°ç»„ä¸é€‰æ‹©å™¨ï¼ˆå¦‚ `["utils:model1", "utils:model2", "replyer"]`ï¼‰ã€‚
- **`schedule.import_times`**: å®šæ—¶è‡ªåŠ¨å¯¼å…¥æ—¶é—´ç‚¹åˆ—è¡¨ (e.g., `["04:00"]`).

#### ğŸ›¡ï¸ èŠå¤©æµè¿‡æ»¤ `[filter]`

- **`mode`**: `whitelist` (ç™½åå•) æˆ– `blacklist` (é»‘åå•)ã€‚
- **`chats`**: ç›®æ ‡åˆ—è¡¨ã€‚æ”¯æŒ `group:123`(ç¾¤), `user:456`(ç§èŠ), `stream:hash`(æµID) æˆ–çº¯æ•°å­— ID(å…¼å®¹)ã€‚

#### ğŸ–¥ï¸ å¯è§†åŒ–ä¸è°ƒè¯• `[web] & [advanced]`

- **`web.port`**: å¯è§†åŒ–ç•Œé¢ç«¯å£ (é»˜è®¤ 8082)ã€‚
- **`advanced.debug`**: å¼€å¯è¯¦ç»†è°ƒè¯•æ—¥å¿—ã€‚

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### ç›®å½•ç»“æ„

```
plugins/A_memorix/
â”œâ”€â”€ core/                     # æ ¸å¿ƒå¼•æ“
â”‚   â”œâ”€â”€ storage/              # å‘é‡ã€å›¾ã€å…ƒæ•°æ®å­˜å‚¨ï¼ˆNPZ, PKL, SQLiteï¼‰
â”‚   â”œâ”€â”€ embedding/            # åµŒå…¥ç”Ÿæˆï¼ˆè°ƒç”¨ä¸»ç¨‹åº APIï¼‰
â”‚   â”œâ”€â”€ retrieval/            # åŒè·¯æ£€ç´¢ä¸æ’åº (PPR ç®—æ³•)
â”‚   â””â”€â”€ utils/                # æ–‡æœ¬è§„èŒƒåŒ–ä¸å“ˆå¸Œå·¥å…·
â”œâ”€â”€ scripts/                  # è‡ªåŠ¨åŒ–è„šæœ¬
â”‚   â””â”€â”€ process_knowledge.py  # æ‰¹é‡å¯¼å…¥å·¥å…·
â”œâ”€â”€ components/               # æ’ä»¶ç»„ä»¶
â”‚   â”œâ”€â”€ commands/             # æŒ‡ä»¤é›† (/import, /query, etc.)
â”‚   â”œâ”€â”€ tools/                # LLM å¤–éƒ¨å·¥å…· (knowledge_query)
â”‚   â””â”€â”€ actions/              # è‡ªåŠ¨è¡Œä¸º (knowledge_search)
â”œâ”€â”€ server.py                 # FastAPI å¯è§†åŒ–æœåŠ¡å™¨åç«¯
â”œâ”€â”€ data/                     # ç‹¬ç«‹æ•°æ®ç›®å½•ï¼ˆå­˜å‚¨äºæ’ä»¶æ–‡ä»¶å¤¹å†…ï¼‰
â””â”€â”€ config.toml               # æ’ä»¶é…ç½®æ–‡ä»¶
```

---

## ğŸ”’ ç‹¬ç«‹æ€§å£°æ˜

A_Memorix æ˜¯**å®Œå…¨ç‹¬ç«‹**çš„çŸ¥è¯†ç®¡ç†ç³»ç»Ÿï¼Œä¸åŸ LPMM åœ¨æŠ€æœ¯å®ç°ä¸Šæœ‰æœ¬è´¨åŒºåˆ«ï¼š

| ç»´åº¦         | åŸ LPMM               | A_Memorix                         |
| ------------ | --------------------- | --------------------------------- |
| **åç«¯å¼•æ“** | åŸºäºå¯¹è±¡/å­—å…¸çš„å›¾ç®—æ³• | åŸºäº SciPy ç¨€ç–çŸ©é˜µçš„çº¿æ€§ä»£æ•°è®¡ç®— |
| **å‘é‡æ ¼å¼** | float32 (é«˜å†…å­˜æ¶ˆè€—)  | Faiss SQ8 é‡åŒ– (æè‡´å†…å­˜å‹ç¼©)     |
| **å­˜å‚¨è·¯å¾„** | å…¨å±€ `data/` ç›®å½•     | éš”ç¦»çš„ `plugins/A_memorix/data/`  |
| **ä¾èµ–å…³ç³»** | ä¸ä¸»ç¨‹åºé€»è¾‘æ··æ‚      | æ¨¡å—åŒ–è§£è€¦ï¼Œå¯ç‹¬ç«‹å‡çº§            |
| **æ•°æ®æ ¼å¼** | JSON/SQLite           | NPZ/PKL/SQLite                    |

---

## ğŸ“œ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [AGPL-3.0](https://www.gnu.org/licenses/agpl-3.0) è®¸å¯è¯ã€‚

## è´¡çŒ®å£°æ˜

æœ¬é¡¹ç›®ç›®å‰ä¸æ¥å—ä»»ä½•PRï¼Œåªæ¥å—issueï¼Œå¦‚æœ‰ç›¸å…³é—®é¢˜è¯·æäº¤issueæˆ–è”ç³»ARC

**ä½œè€…**: A_Dawn
